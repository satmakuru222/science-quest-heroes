import{createClient as u}from"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/+esm";import{s as i}from"./config-4EZbmldV.js";const d=i.url,h=i.anonKey,n=u(d,h),c=document.getElementById("userMenuTrigger"),s=document.getElementById("dropdownMenu"),m=document.getElementById("logoutBtn"),o=document.getElementById("userAvatar"),f=document.getElementById("userName");async function p(){const{data:{session:t}}=await n.auth.getSession();if(!t){window.location.href="auth.html";return}const{data:e,error:r}=await n.from("user_profiles").select("*").eq("id",t.user.id).maybeSingle();if(r){console.error("Error loading profile:",r);return}if(!e){window.location.href="auth.html";return}const a=window.location.pathname;if(a.includes("parent-dashboard.html")&&e.account_type!=="parent"){e.account_type==="teacher"?window.location.href="teacher-dashboard.html":e.account_type==="student"?window.location.href="student-dashboard.html":window.location.href="index.html";return}if(a.includes("teacher-dashboard.html")&&e.account_type!=="teacher"){e.account_type==="parent"?window.location.href="parent-dashboard.html":e.account_type==="student"?window.location.href="student-dashboard.html":window.location.href="index.html";return}g(t.user.id)}async function g(t){try{const{data:e,error:r}=await n.from("user_profiles").select("*").eq("id",t).maybeSingle();if(r)throw r;if(e){let a;if(e.account_type==="parent"||e.account_type==="teacher"?a=e.email:a=e.first_name||e.full_name||e.username||e.email,f.textContent=a,e.avatar_url)o.innerHTML=`<img src="${e.avatar_url}" alt="Avatar">`;else if(e.email&&(e.account_type==="parent"||e.account_type==="teacher"))o.textContent=e.email.charAt(0).toUpperCase();else if(e.first_name)o.textContent=e.first_name.charAt(0).toUpperCase();else if(e.username)o.textContent=e.username.charAt(0).toUpperCase();else{const l=e.account_type.charAt(0).toUpperCase();o.textContent=l}}}catch(e){console.error("Error loading profile:",e)}}c.addEventListener("click",t=>{t.stopPropagation(),s.classList.toggle("show")});document.addEventListener("click",t=>{!c.contains(t.target)&&!s.contains(t.target)&&s.classList.remove("show")});m.addEventListener("click",async()=>{try{const{error:t}=await n.auth.signOut();if(t)throw t;localStorage.clear(),sessionStorage.clear(),window.location.href="auth.html"}catch(t){console.error("Logout error:",t),alert("Failed to logout. Please try again.")}});p();
