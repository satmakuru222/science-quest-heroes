import{s as i}from"./config-4EZbmldV.js";import{createClient as l}from"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/+esm";const d=i.url,u=i.anonKey,o=l(d,u),c=document.getElementById("userMenuTrigger"),s=document.getElementById("dropdownMenu"),m=document.getElementById("logoutBtn"),a=document.getElementById("userAvatar"),g=document.getElementById("userName"),h=document.getElementById("welcomeMessage"),r=document.getElementById("avatarDisplay"),f=document.getElementById("currentGrade");async function w(){const{data:{session:e}}=await o.auth.getSession();if(!e){window.location.href="auth.html";return}const{data:t,error:n}=await o.from("user_profiles").select("*").eq("id",e.user.id).maybeSingle();if(n){console.error("Error loading profile:",n);return}if(!t){window.location.href="auth.html";return}if(t.account_type!=="student"){t.account_type==="parent"?window.location.href="parent-dashboard.html":t.account_type==="teacher"?window.location.href="teacher-dashboard.html":window.location.href="index.html";return}y(t)}async function y(e){try{const t=e.first_name||e.full_name||e.username||"Hero";if(g.textContent=t,h.textContent=`Welcome back, ${t}!`,e.avatar_url)a.innerHTML=`<img src="${e.avatar_url}" alt="Avatar">`,r.innerHTML=`<img src="${e.avatar_url}" alt="Avatar">`;else if(e.first_name){const n=e.first_name.charAt(0).toUpperCase();a.textContent=n,r.innerHTML=`<div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #22c55e, #16a34a); font-size: 48px; font-weight: 800; color: white;">${n}</div>`}else a.innerHTML='<i class="fas fa-user"></i>',r.innerHTML='<i class="fas fa-user text-white text-5xl"></i>';e.grade_level&&(f.textContent=e.grade_level)}catch(t){console.error("Error loading profile:",t)}}c.addEventListener("click",e=>{e.stopPropagation(),s.classList.toggle("show")});document.addEventListener("click",e=>{!c.contains(e.target)&&!s.contains(e.target)&&s.classList.remove("show")});m.addEventListener("click",async()=>{try{const{error:e}=await o.auth.signOut();if(e)throw e;localStorage.clear(),sessionStorage.clear(),window.location.href="auth.html"}catch(e){console.error("Logout error:",e),alert("Failed to logout. Please try again.")}});w();
